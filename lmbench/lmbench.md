# lmbench 测试用例

## 题目描述

lmbench 是一个用于测量 Unix 系统性能的基准测试工具，最初发布于 1995 年，作者是Larry McVoy，时任 Sun Microsystems 工程师，也是 BitKeeper 等工具的作者。Sun Microsystems 在 90 年代主导工作站和服务器市场，LMbench 应运而生以解决系统级性能评估的需求。它旨在提供一套微基准测试工具，帮助开发者理解硬件和操作系统的底层性能特征。

本测试使用的是lmbench 3-增加了对现代多核处理器、大规模内存和新型文件系统的支持。LMbench 通过微基准测试（Microbenchmarks）测量系统的延迟和带宽，涵盖以下核心模块：

- **处理器与内存**

  - **上下文切换**：进程/线程切换的时间开销。
  - **内存延迟**：不同层级（L1/L2 缓存、主存）的访问延迟。
  - **整数/浮点运算**：基础计算性能。
- **文件系统**

  - **文件读写**：小文件和大文件的顺序/随机读写速度。
  - **文件创建/删除**：操作系统的文件管理效率。
- **网络**

  - **TCP/UDP 延迟**：本地回环和远程通信的延迟。
  - **带宽测试**：最大传输速率。
- **进程与线程**

  - **进程创建**：`fork()` + `exec()` 的开销。
  - **信号处理**：信号传递与响应时间。
  - **管道/套接字通信**：进程间通信（IPC）效率。
- **其他**

  - **系统调用开销**：如 `getpid()`、`open()`/`close()`。
  - **内存带宽**：如 `memset`、`memcpy` 的速度。

在我们的测试中，涉及的测试项目参见**评分依据**。

## 编译方法

执行以下命令自动测试并编译lmbench：

```bash
make build
make oscomp
```

然后执行[脚本](https://github.com/oscomp/testsuits-for-oskernel/blob/pre-2025/scripts/lmbench/lmbench_testcode.sh)，获得输出。

## 评分依据

| 测试项目                         | 单位              | 预期范围        | 评分原则 |
| -------------------------------- | ----------------- | --------------- | -------- |
| 空系统调用操作延迟               | 微秒              | 0.0757 - 2.0    | 越小越好 |
| 读系统调用延迟                   | 微秒              | 0.1 - 2.2       | 越小越好 |
| 写系统调用延迟                   | 微秒              | 0.1 - 2.2       | 越小越好 |
| stat 系统调用延迟                | 微秒              | 0.5 - 2.1       | 越小越好 |
| fstat 系统调用延迟               | 微秒              | 0.15 - 2.0      | 越小越好 |
| open 系统调用延迟                | 微秒              | 1.0 - 3.0       | 越小越好 |
| select 系统调用延迟              | 微秒              | 0.5 - 2.7       | 越小越好 |
| 信号安装延迟                     | 微秒              | 0.1 - 2.3       | 越小越好 |
| 信号捕获延迟                     | 微秒              | 0.8 - 2.0       | 越小越好 |
| 信号保护延迟                     | 微秒              | 0.3 - 2.5       | 越小越好 |
| 管道延迟                         | 微秒              | 4 - 20          | 越小越好 |
| 进程 fork 延迟                   | 微秒              | 94 - 200        | 越小越好 |
| 进程 exec 延迟                   | 微秒              | 101 - 300       | 越小越好 |
| 进程 shell 延迟                  | 微秒              | 300 - 2000      | 越小越好 |
| 文件系统写入带宽                 | KB/秒             | 3000 - 200000   | 越大越好 |
| 页面错误延迟                     | 微秒              | 0.1 - 3.2       | 越小越好 |
| mmap 延迟                        | 微秒              | 0.3 - 10        | 越小越好 |
| 管道带宽                         | KB/秒             | 1000 - 10000    | 越大越好 |
| 文件系统延迟                     | 每秒创建+删除次数 | 100000 - 300000 | 越大越好 |
| 512k 文件读取速度（仅 I/O）      | MB/秒             | 0.5 - 2.0       | 越大越好 |
| 512k 文件读取速度（打开至关闭）  | MB/秒             | 0.5 - 2.2       | 越大越好 |
| 512k mmap 读取速度（mmaponly）   | MB/秒             | 0.5 - 3.0       | 越大越好 |
| 512k mmap 读取速度（open2close） | MB/秒             | 0.5 - 3.0       | 越大越好 |
| 上下文切换延迟（96 进程时）      | 微秒              | 1 - 5.0         | 越小越好 |
