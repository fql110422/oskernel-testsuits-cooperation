## 测试题目说明

### 1. 题目描述

`iperf3` 是一个用于测量 TCP、UDP 和 SCTP 网络带宽的工具。在本测试中，学生将学习如何在 ArceOS 操作系统上编译和运行 `iperf3`，并使用该工具进行网络带宽的测试。此外，学生还需要理解如何修改 `iperf3` 的源代码，并在 ArceOS 上优化其性能。

### 2. 编译方法

在 ArceOS 上编译并运行 `iperf3` 服务器和客户端，按照以下步骤操作：

#### 步骤 1：编译 `iperf3`

在 ArceOS 的根目录下，使用以下命令来编译和启动 `iperf3` 服务器：

```bash
# 在 ArceOS 根目录下
make A=apps/c/iperf BLK=y NET=y ARCH=<arch> run
```

- `A=apps/c/iperf`：指定 `iperf` 应用程序的路径。
- `BLK=y` 和 `NET=y`：启用块设备和网络支持。
- `ARCH=<arch>`：指定目标架构（如 `x86_64`）。

#### 步骤 2：修改和构建代码（根据需要）

根据 `iperf.patch` 中的代码修改，修改 `iperf3` 源代码文件，并重新编译。

修改的部分包括：
- 优化内存管理，使用 `malloc` 替代 `mmap` 来创建缓冲区。
- 修复一些头文件和库的引用。
- 修改 `iperf3` 的网络配置，包括禁用 `sched_setaffinity` 相关的代码，以便于 ArceOS 环境的兼容性。

#### 步骤 3：运行 `iperf3` 服务器

在 ArceOS 上启动 `iperf3` 服务器：

```bash
# 启动 iperf3 服务器
iperf3 -s -p 5555
```

#### 步骤 4：运行 `iperf3` 客户端

在另一个终端或机器上运行 `iperf3` 客户端进行网络带宽测试：

```bash
# 作为客户端运行
iperf3 -c 127.0.0.1 -p 5555
```

### 3. 样例输出

当 `iperf3` 在 ArceOS 上运行时，服务器和客户端的输出应如下所示：

**服务器端输出：**

```
-----------------------------------------------------------
Server listening on 5555
-----------------------------------------------------------
[  5] local 0.0.0.0 port 5555 connected to 127.0.0.1 port 5555
[  5]  0.0-10.0 sec  1.23 GBytes  1.05 Gbits/sec
```

**客户端输出：**

```
-----------------------------------------------------------
Client connecting to 127.0.0.1, port 5555
-----------------------------------------------------------
[  5] local 127.0.0.1 port 54321 connected to 127.0.0.1 port 5555
[  5]  0.0-10.0 sec  1.23 GBytes  1.05 Gbits/sec
```

### 4. 评分依据

评分将根据以下几个方面进行：

- **正确性**：能否成功在 ArceOS 上编译并运行 `iperf3` 服务器和客户端。
- **性能测试**：是否能够在 `iperf3` 中使用 TCP 和 UDP 模式进行网络带宽测试，并理解其输出结果。
- **代码修改**：能否根据 `iperf.patch` 中的指示修改 `iperf3` 代码，包括内存管理和网络配置。
- **理解与优化**：能否根据 `iperf3` 的参数优化网络带宽测试，如调整缓冲区大小和发送比特率等。
- **异常处理**：能否处理测试过程中可能出现的错误，并进行适当的调试。


